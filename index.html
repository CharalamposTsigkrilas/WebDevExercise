<html>

<head>
    <title>Request for books</title>

    <meta charset="utf-8">

    <style>
        h1 {
            text-align: center;
        }
        p {
            text-align: center;
        }
    </style>

</head>

<body>

    <!-- Form for book creation-->
    <h1>Book Information</h1>

    <p>Author:<input type="text" id="author"></p>
    <p>Title:<input type="text" id="title" name="title"></p>
    <p>Genre:
        <select name="genre" id="genre">
            <option value="select" selected disabled>----Select genre----</option>
            <option value="science fiction">Science fiction</option>
            <option value="satire">Satire</option>
            <option value="drama">Drama</option>
            <option value="action and adventure">Action and Adventure</option>
            <option value="romance">Romance</option>
            <option value="mystery">Mystery</option>
            <option value="horror">Horror</option>
        </select>
    </p>
    <p>Price (â‚¬):<input type="number" min="0" id="price" name="price"></p>

    <p><input type="button" id="addButton" value="Add book"></p>


    <h1>Book search</h1>

    <p>Keyword for books:<input type="text" id="keyword" onkeypress="antiSpace()" name="keyword"></p>

    <p><input type="button" id="searchButton" value="Search books"></p>


    <script type="text/javascript">

        // On keyword input allow only one word        
        function antiSpace() {
            const searchInput = document.getElementById("keyword");
            searchInput.addEventListener('keypress', (event) => {
                if (event.keyCode === 32) {
                    event.preventDefault();
                }
            });
        }

        // Books model
        class Book {
            constructor(id, author, title, genre, price) {
                this.id = id;
                this.author = author;
                this.title = title;
                this.genre = genre;
                this.price = price;
            }
        }

        // "Add book" button handler
        document.getElementById('addButton').addEventListener('click', async (e) => {

            var id;
            const author = document.getElementById('author').value;
            const title = document.getElementById('title').value;
            const genre = document.getElementById('genre').value;
            const price = document.getElementById('price').value;

            // Field inputs checks
            if (author.length === 0 || title.length === 0 || price.length === 0 || genre == "select") {

                console.log("All fields must be filled!");
                alert("All fields must be filled!");

            } else if (price <= 0) {

                console.log("Price must be a positive number!");
                alert("Price must be a positive number!");

            } else {

                // Create a new Book
                const book = new Book(id, author, title, genre, price);

                // Execute the request
                const url = 'http://localhost:3000/books';

                const result = await fetch(url, {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(book)
                });

                // Print the result
                console.log(result.json());
                console.log("Book has been added succesfuly!");
                alert("Book has been added succesfuly!");

                // Clear all the textboxes after the book entry
                const inputArray = document.getElementsByTagName('input');
                for (input of inputArray) {
                    if (input.type == 'text' || input.type == 'number') {
                        input.value = '';
                    }
                }

                // Reset the genre to unselected
                const dropdown = document.getElementById('genre');
                dropdown.value = "select";
            }

        });

        // "Search book" button handler
        document.getElementById('searchButton').addEventListener('click', async (e) => {

            const keyword = document.getElementById('keyword').value;

            // Input check
            if (keyword.length === 0) {
                console.log("No keyword was given!");
                alert("No keyword was given!");
            }

            // Execute the request
            const url = `http://localhost:3000/books/${keyword}`;

            const result = await fetch(url, {
                method: 'GET',
                headers: {
                    "Content-Type": "application/json"
                }
            });

            // Print the result
            console.log(result.json());

            // A new window opens with the results
            window.open(url);

            // Clear all the textboxes after the keyword entry 
            const inputArray = document.getElementsByTagName('input');
            for (input of inputArray) {
                if (input.type == 'text' || input.type == 'number') {
                    input.value = '';
                }
            }

        });

    </script>

</body>

</html>