<html>
    <head>
        <!--A title for the index.html page-->
        <title>Request for books</title>

        <!--We allow all Greek characters-->
        <meta charset="utf-8">
        
        <!--We edit the style of the page so every text and dropdown list be centered-->
        <!--Found this at: https://www.computerhope.com/issues/ch001474.htm -->
        <style>h1{text-align: center;}</style>
        <style>p{text-align: center;}</style>                 

    </head>
    <body>

        <!--A heading text-->
        <h1>Book information</h1>

        <!--A text input box for author-->
        <p>Author:<input type="text" id="author"></p>

        <!--A text input box for title-->
        <p>Title:<input type="text" id="title" name="title"></p>

        <!--Genre is a dropdown list with options-->
        <p>Genre:
            <select name="genre" id="genre">
                <option value="select" selected disabled>----Select genre----</option>
                <option value="science fiction">Science fiction</option>
                <option value="satire">Satire</option>
                <option value="drama">Drama</option>
                <option value="action and adventure">Action and Adventure</option>
                <option value="romance">Romance</option>
                <option value="mystery">Mystery</option>
                <option value="horror">Horror</option>
            </select>
        </p>
            
        <!--A number (text) input box for price-->
        <p>Price(â‚¬):<input type="number" min="0" id="price" name="price"></p>

        <!--After the inputs we have a button-->
        <p><input type="button" id="addButton" value="Add book"></p>

        <!--A heading text-->
        <h1>Book search</h1>

        <!--A text input box for the keyword-->
        <p>Keyword for books:<input type="text" id="keyword" onkeypress="antiSpace()" name="keyword"></p>
         
        <!--After the input we have another button-->
        <p><input type="button" id="searchButton" value="Search books"></p>
        
        <!--Javasript code we need to use inside the .html file in order to call post and get methods. Also we do the rigth checks and cleans.-->
        <script type="text/javascript">
        
            //At the keyword input we don't let the user write more than one word
            //Found this at: https://stackoverflow.com/questions/32366300/how-prevent-whitespace-in-input-field-with-plain-javascript            
            function antiSpace(){
                const searchInput = document.getElementById("keyword");
                searchInput.addEventListener('keypress', (event) => { 
                    if (event.keyCode === 32) {
                        event.preventDefault();
                    }
                });
            }

            //We create a class for books with all the atributes
            class Book{
                constructor(id,author,title,genre,price){
                    this.id = id;
                    this.author = author;
                    this.title = title;
                    this.genre = genre;
                    this.price = price;
                }                
            }

            //This part is running when "Add book" button is clicked
            document.getElementById('addButton').addEventListener('click',async (e)=>{                
                
                //We assign all the input into variables
                //We don't give id a value because it takes by itself and it's auto increased
                var id;
                const author = document.getElementById('author').value;
                const title = document.getElementById('title').value;
                const genre = document.getElementById('genre').value;
                const price = document.getElementById('price').value;

                //Here checking if all the inputs are given and the price is positive.
                //If not, an alert message pops up and user must give inputs again.
                if(author.length === 0 || title.length === 0 || price.length === 0 || genre == "select"){

                    console.log("All fields must be filled!");
                    alert("All fields must be filled!"); 

                }else if(price<=0){

                    console.log("Price must be a positive number!");
                    alert("Price must be a positive number!");    

                }else{

                    //Creating a new Book object with all atributes
                    const book = new Book(id,author,title,genre,price);

                    //The url we using with POST method and stringify the book object into a JSON
                    const url = 'http://localhost:3000/books/';

                    const result = await fetch(url,{
                        method:'POST',
                        headers: {
                            "Content-Type":"application/json"
                        },
                        body: JSON.stringify(book)
                    });

                    //Printing the result
                    console.log(result.json());                 
                    console.log("Book has been added succesfuly!");
                    alert("Book has been added succesfuly!");

                    //After the book entry we clear all the textboxes
                    const inputArray = document.getElementsByTagName('input');
                    for(input of inputArray){
                        if(input.type == 'text' || input.type == 'number'){
                            input.value = '';
                        }
                    }

                    //Also we reset the genre to uselected
                    const dropdown = document.getElementById('genre');                   
                    dropdown.value ="select";
                }

            });

            //This part is running when "Search book" button is clicked
            document.getElementById('searchButton').addEventListener('click',async (e)=>{

                //Assign keyword input into a variable
                const keyword = document.getElementById('keyword').value;

                //Checking if a keyword is given
                if(keyword.length === 0){

                    console.log("No keyword was given!");
                    alert("No keyword was given!"); 
                }

                //The url we using with GET method
                const url = `http://localhost:3000/books/${keyword}`;

                const result = await fetch(url,{
                    method:'GET',
                    headers: {
                        "Content-Type":"application/json"
                    }
                });
                
                //Printing the result
                console.log(result.json());

                //A new window with the url opens
                //Found this at: https://stackoverflow.com/questions/4643958/open-button-in-new-window
                window.open(url);                  

                //After the keyword entry we clear all the textboxes
                const inputArray = document.getElementsByTagName('input');
                for(input of inputArray){
                    if(input.type == 'text' || input.type == 'number'){
                        input.value = '';
                    }
                }

            });

        </script>

    </body>
</html>