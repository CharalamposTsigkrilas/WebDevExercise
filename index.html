<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>Book Manager</title>

    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>

    <h1>Book Management</h1>

    <div class="container">

        <!-- Book creation form -->
        <div class="card">
            <h2>Add a New Book</h2>
            <div class="form-group">
                <label for="author">Author</label>
                <input type="text" id="author" placeholder="">
            </div>
            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" id="title">
            </div>
            <div class="form-group">
                <label for="genre">Genre</label>
                <select id="genre">
                    <option value="select" selected disabled>---- Select genre ----</option>
                    <option value="science fiction">Science fiction</option>
                    <option value="satire">Satire</option>
                    <option value="drama">Drama</option>
                    <option value="action and adventure">Action and Adventure</option>
                    <option value="romance">Romance</option>
                    <option value="mystery">Mystery</option>
                    <option value="horror">Horror</option>
                </select>
            </div>
            <div class="form-group">
                <label for="price">Price (€)</label>
                <input type="number" min="0" placeholder="0.00" id="price">
            </div>
            <button id="addButton" class="button">Add Book</button>
        </div>

        <!-- Book search form -->
        <div class="card">
            <h2>Search Books</h2>
            <div class="form-group">
                <label for="keyword">Keyword</label>
                <input type="text" id="keyword" placeholder="Type a keyword..." onkeypress="antiSpace()">
            </div>
            <button id="searchButton" class="button">Search</button>
        </div>

    </div>

    <footer>© Book Manager WebDev</footer>

    <script type="text/javascript">

        // On keyword input allow only one word        
        function antiSpace() {
            const searchInput = document.getElementById("keyword");
            searchInput.addEventListener('keypress', (event) => {
                if (event.keyCode === 32) {
                    event.preventDefault();
                }
            });
        }

        // Books class
        class Book {
            constructor(id, author, title, genre, price) {
                this.id = id;
                this.author = author;
                this.title = title;
                this.genre = genre;
                this.price = price;
            }
        }

        // "Add book" button handler
        document.getElementById('addButton').addEventListener('click', async () => {

            const author = document.getElementById('author').value.trim();
            const title = document.getElementById('title').value.trim();
            const genre = document.getElementById('genre').value;
            const price = parseFloat(document.getElementById('price').value);

            if (!author || !title || !genre || genre === "select" || isNaN(price)) {
                alert("All fields must be filled correctly!");
                return;
            }

            if (price <= 0) {
                alert("Price must be a positive number!");
                return;
            }

            const book = new Book(null, author, title, genre, price);

            const url = "http://localhost:3000/books";

            try {
                const result = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(book)
                });

                if (!result.ok) {
                    throw new Error("Failed to add book.");
                }

                alert("Book added successfully!");

                // Clear all the inputs
                document.getElementById('author').value = '';
                document.getElementById('title').value = '';
                document.getElementById('genre').value = 'select';
                document.getElementById('price').value = '';

            } catch (err) {
                alert("Error adding book: " + err.message);
            }

        });

        // "Search book" button handler
        document.getElementById('searchButton').addEventListener('click', async () => {

            const keyword = document.getElementById('keyword').value.trim();

            if (!keyword) {
                alert("Please enter a keyword to search!");
                return;
            }

            // Execute the request
            const url = `http://localhost:3000/books/${keyword}`;

            // A new window opens with the results
            window.open(url, "_blank");

            // Clear the input 
            document.getElementById('keyword').value = '';

        });

    </script>

</body>

</html>